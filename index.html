<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Tracking Operación de Descarga - Plantilla Avanzada</title>
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <style>
    html, body { height: 100%; margin: 0; font-family: Inter, Arial; background: #f3f4f6; color: #0f172a; padding: 18px;}
    .container { max-width: 1200px; margin: 0 auto;}
    .card { background: #fff; border-radius: 8px; padding: 12px; box-shadow: 0 1px 4px rgba(2,6,23,.08); margin-bottom: 12px;}
    label { display: block; font-size: 13px; color: #54627a; margin-bottom: 6px;}
    input, select, textarea { width: 100%; padding: 8px; border: 1px solid #e6e9ef; border-radius: 6px; font-size: 14px;}
    button { background: #06b6d4; color: white; padding: 8px 10px; border: 0; border-radius: 6px; cursor: pointer;}
    .grid-2 { display: grid; grid-template-columns: repeat(2,1fr); gap: 12px;}
    .grid-3 { display: grid; grid-template-columns: repeat(3,1fr); gap: 12px;}
    .muted { color: #6b7280; font-size: 13px;}
    .controls { display: flex; gap: 8px; align-items: center;}
    .row { display: flex; align-items: center; gap: 18px; margin-top: 8px;}
    .col { display: flex; flex-direction: column; gap: 6px;}
    .dash-group { display: flex; gap:24px; margin-bottom:18px;}
    .dash-cant { background: #e6f0ff; border-radius:10px; padding:18px; flex:2 1 0;}
    .dash-time { background: #ece2fe; border-radius:10px; padding:18px; flex:1 1 0;}
    table.dash-cant-table { width:100%; margin-top:10px; border-collapse:collapse;}
    table.dash-cant-table th,table.dash-cant-table td{ padding:3px 8px; }
    @media (max-width:900px) {.grid-3,.grid-2,.dash-group{flex-direction:column;grid-template-columns:1fr;}}
  </style>
</head>
<body>
<div class="container">
  <h1>Tracking descarga Buques a granel</h1>
  <div class="card">
    <strong>Ficha general</strong>
    <div class="muted">Datos generales del buque.</div>
    <div class="grid-3">
      <div><label>Nombre del buque</label><input id="vessel"></div>
      <div><label>PRESENTACIÓN NOR Fecha - Hora</label><input id="nor" type="datetime-local"></div>
      <div><label>ETA Fecha - Hora</label><input id="eta" type="datetime-local"></div>
    </div>
    <div class="grid-3" style="margin-top:8px;">
      <div><label>Inicio de operaciones</label><input id="startOp" type="datetime-local"></div>
      <div><label>Fin de operaciones</label><input id="endOp" type="datetime-local"></div>
      <div><label>Observaciones generales</label><input id="obsGeneral"></div>
    </div>
    <div class="controls" style="margin-top:10px;">
      <button onclick="saveHeader()">Guardar ficha</button>
      <button onclick="updateAll()">Actualizar dashboard</button>
      <span class="muted" style="margin-left:auto;">* campos obligatorios</span>
    </div>
  </div>
  <div class="card">
    <strong>Productos manifestados</strong>
    <div class="grid-2" style="margin-top:8px;">
      <div><label>Producto</label><input id="prodNameM"></div>
      <div><label>Cantidad manifestada TM</label><input id="prodManifest" type="number" step="0.01"></div>
    </div>
    <div class="controls" style="margin-top:8px;">
      <button onclick="addProductManifest()">Agregar producto manifestado</button>
      <button onclick="exportProductsMCSV()" style="background:#111827;">Exportar manifestados CSV</button>
      <span class="muted" style="margin-left:auto;">Total manifestados: <span id="prodMCount">0</span></span>
    </div>
    <table id="prodMTable">
      <thead>
        <tr><th>#</th><th>Producto</th><th>Manifestado (TM)</th><th>Pendiente (TM)</th><th>Acciones</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <div class="card">
    <strong>Productos descargados</strong>
    <div class="grid-2" style="margin-top:8px;">
      <div><label>Producto</label><input id="prodNameD"></div>
      <div><label>Cantidad descargada TM</label><input id="prodDownloaded" type="number" step="0.01"></div>
    </div>
    <div class="controls" style="margin-top:8px;">
      <button onclick="addProductDownloaded()">Agregar producto descargado</button>
      <button onclick="exportProductsDCSV()" style="background:#111827;">Exportar descargados CSV</button>
      <span class="muted" style="margin-left:auto;">Total descargados: <span id="prodDCount">0</span></span>
    </div>
    <table id="prodDTable">
      <thead>
        <tr><th>#</th><th>Producto</th><th>Descargado (TM)</th><th>Acciones</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <div class="card">
    <strong>Registro de paradas (incidentes)</strong>
    <div class="col" style="margin-top:8px;max-width:380px;">
      <label>Motivo</label>
      <select id="incReason">
        <option value="lluvia">Lluvia</option>
        <option value="movimiento buque">Movimiento Buque</option>
        <option value="paro por mecanizado">Paro por mecanizado</option>
        <option value="falta camiones">Falta camiones</option>
        <option value="problemas buque interno">Problemas buque interno</option>
        <option value="otros">Otros</option>
      </select>
      <label>Bodega afectada</label>
      <select id="incBodega">
        <option value="Bodega 1">Bodega 1</option>
        <option value="Bodega 2">Bodega 2</option>
        <option value="Buque completo">Buque completo</option>
      </select>
      <button onclick="inicioIncidente()">Inicio incidente</button>
      <button onclick="finIncidente()">Fin incidente</button>
      <button onclick="exportIncidentsCSV()" style="background:#111827;">Exportar CSV</button>
    </div>
    <div class="row">
      <strong>Tiempo total de paradas: <span id="statDowntime">0</span> min</strong>
      <span>
        Filtrar motivo:
        <select id="filterReason" onchange="updateAll()">
          <option value="Todos">Todos</option>
          <option value="lluvia">Lluvia</option>
          <option value="movimiento buque">Movimiento Buque</option>
          <option value="paro por mecanizado">Paro por mecanizado</option>
          <option value="falta camiones">Falta camiones</option>
          <option value="problemas buque interno">Problemas buque interno</option>
          <option value="otros">Otros</option>
        </select>
        <strong style="margin-left:10px;">Total motivo: <span id="statDowntimeFilter">0</span> min</strong>
      </span>
    </div>
    <table id="incTable">
      <thead>
        <tr><th>#</th><th>Inicio</th><th>Fin</th><th>Minutos</th><th>Motivo</th><th>Bodega</th><th>Acciones</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
